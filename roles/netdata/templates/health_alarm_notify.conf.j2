# Netdata Health Alarm Notification Configuration
# Generated by Ansible role: almir.netdata

# ============================================================================
# DEFAULT RECIPIENTS
# ============================================================================
{% if netdata_email_enabled | bool and netdata_email_recipient | length > 0 %}
DEFAULT_RECIPIENT_EMAIL="{{ netdata_email_recipient }}"
{% endif %}

{% if netdata_slack_enabled | bool and netdata_slack_webhook_url | length > 0 %}
DEFAULT_RECIPIENT_SLACK="#{{ netdata_slack_channel | regex_replace('^#', '') }}"
{% endif %}

{% if netdata_discord_enabled | bool and netdata_discord_webhook_url | length > 0 %}
DEFAULT_RECIPIENT_DISCORD="{{ netdata_discord_webhook_url }}"
{% endif %}

{% if netdata_pagerduty_enabled | bool and netdata_pagerduty_service_key | length > 0 %}
DEFAULT_RECIPIENT_PAGERDUTY="{{ netdata_pagerduty_service_key }}"
{% endif %}

{% if netdata_telegram_enabled | bool and netdata_telegram_bot_token | length > 0 and netdata_telegram_chat_id | length > 0 %}
DEFAULT_RECIPIENT_TELEGRAM="{{ netdata_telegram_chat_id }}"
{% endif %}

{% if netdata_teams_enabled | bool and netdata_teams_webhook_url | length > 0 %}
DEFAULT_RECIPIENT_TEAMS="{{ netdata_teams_webhook_url }}"
{% endif %}

{% if netdata_rocketchat_enabled | bool and netdata_rocketchat_webhook_url | length > 0 %}
DEFAULT_RECIPIENT_ROCKETCHAT="#{{ netdata_rocketchat_channel | regex_replace('^#', '') }}"
{% endif %}

{% if netdata_twilio_enabled | bool and netdata_twilio_to_number | length > 0 %}
DEFAULT_RECIPIENT_TWILIO="{{ netdata_twilio_to_number }}"
{% endif %}

{% if netdata_pushover_enabled | bool and netdata_pushover_user_key | length > 0 %}
DEFAULT_RECIPIENT_PUSHOVER="{{ netdata_pushover_user_key }}"
{% endif %}

{% if netdata_pushbullet_enabled | bool and netdata_pushbullet_api_token | length > 0 %}
DEFAULT_RECIPIENT_PUSHBULLET="{{ netdata_pushbullet_api_token }}"
{% endif %}

# ============================================================================
# EMAIL NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_email_enabled | bool %}
SEND_EMAIL="YES"
{% if netdata_email_sender | length > 0 %}
SENDER="{{ netdata_email_sender }}"
{% endif %}
{% if netdata_smtp_server | length > 0 %}
SMTP_SERVER="{{ netdata_smtp_server }}"
{% endif %}
{% if netdata_smtp_port | length > 0 %}
SMTP_PORT="{{ netdata_smtp_port }}"
{% endif %}
{% if netdata_smtp_user | length > 0 %}
SMTP_USER="{{ netdata_smtp_user }}"
{% endif %}
{% if netdata_smtp_password | length > 0 %}
SMTP_PASSWORD="{{ netdata_smtp_password }}"
{% endif %}
{% if netdata_smtp_ssl | bool %}
SMTP_SSL="YES"
{% else %}
SMTP_SSL="NO"
{% endif %}
{% if netdata_smtp_starttls | bool %}
SMTP_STARTTLS="YES"
{% else %}
SMTP_STARTTLS="NO"
{% endif %}
{% else %}
SEND_EMAIL="NO"
{% endif %}

# ============================================================================
# SLACK NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_slack_enabled | bool and netdata_slack_webhook_url | length > 0 %}
SEND_SLACK="YES"
SLACK_WEBHOOK_URL="{{ netdata_slack_webhook_url }}"
{% if netdata_slack_username | length > 0 %}
SLACK_USERNAME="{{ netdata_slack_username }}"
{% endif %}
{% if netdata_slack_icon_emoji | length > 0 %}
SLACK_ICON_EMOJI="{{ netdata_slack_icon_emoji }}"
{% endif %}
{% if netdata_slack_send_resolved | bool %}
SLACK_SEND_RESOLVED="YES"
{% else %}
SLACK_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_SLACK="NO"
{% endif %}

# ============================================================================
# DISCORD NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_discord_enabled | bool and netdata_discord_webhook_url | length > 0 %}
SEND_DISCORD="YES"
DISCORD_WEBHOOK_URL="{{ netdata_discord_webhook_url }}"
{% if netdata_discord_username | length > 0 %}
DISCORD_USERNAME="{{ netdata_discord_username }}"
{% endif %}
{% if netdata_discord_avatar_url | length > 0 %}
DISCORD_AVATAR_URL="{{ netdata_discord_avatar_url }}"
{% endif %}
{% if netdata_discord_send_resolved | bool %}
DISCORD_SEND_RESOLVED="YES"
{% else %}
DISCORD_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_DISCORD="NO"
{% endif %}

# ============================================================================
# PAGERDUTY NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_pagerduty_enabled | bool and netdata_pagerduty_service_key | length > 0 %}
SEND_PAGERDUTY="YES"
PAGERDUTY_SERVICE_KEY="{{ netdata_pagerduty_service_key }}"
{% if netdata_pagerduty_client_name | length > 0 %}
PAGERDUTY_CLIENT_NAME="{{ netdata_pagerduty_client_name }}"
{% endif %}
{% if netdata_pagerduty_send_resolved | bool %}
PAGERDUTY_SEND_RESOLVED="YES"
{% else %}
PAGERDUTY_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_PAGERDUTY="NO"
{% endif %}

# ============================================================================
# TELEGRAM NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_telegram_enabled | bool and netdata_telegram_bot_token | length > 0 and netdata_telegram_chat_id | length > 0 %}
SEND_TELEGRAM="YES"
TELEGRAM_BOT_TOKEN="{{ netdata_telegram_bot_token }}"
TELEGRAM_CHAT_ID="{{ netdata_telegram_chat_id }}"
{% if netdata_telegram_send_resolved | bool %}
TELEGRAM_SEND_RESOLVED="YES"
{% else %}
TELEGRAM_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_TELEGRAM="NO"
{% endif %}

# ============================================================================
# MICROSOFT TEAMS NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_teams_enabled | bool and netdata_teams_webhook_url | length > 0 %}
SEND_TEAMS="YES"
TEAMS_WEBHOOK_URL="{{ netdata_teams_webhook_url }}"
{% if netdata_teams_send_resolved | bool %}
TEAMS_SEND_RESOLVED="YES"
{% else %}
TEAMS_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_TEAMS="NO"
{% endif %}

# ============================================================================
# ROCKET.CHAT NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_rocketchat_enabled | bool and netdata_rocketchat_webhook_url | length > 0 %}
SEND_ROCKETCHAT="YES"
ROCKETCHAT_WEBHOOK_URL="{{ netdata_rocketchat_webhook_url }}"
{% if netdata_rocketchat_channel | length > 0 %}
ROCKETCHAT_CHANNEL="#{{ netdata_rocketchat_channel | regex_replace('^#', '') }}"
{% endif %}
{% if netdata_rocketchat_username | length > 0 %}
ROCKETCHAT_USERNAME="{{ netdata_rocketchat_username }}"
{% endif %}
{% if netdata_rocketchat_icon_emoji | length > 0 %}
ROCKETCHAT_ICON_EMOJI="{{ netdata_rocketchat_icon_emoji }}"
{% endif %}
{% if netdata_rocketchat_send_resolved | bool %}
ROCKETCHAT_SEND_RESOLVED="YES"
{% else %}
ROCKETCHAT_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_ROCKETCHAT="NO"
{% endif %}

# ============================================================================
# TWILIO NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_twilio_enabled | bool and netdata_twilio_account_sid | length > 0 and netdata_twilio_auth_token | length > 0 %}
SEND_TWILIO="YES"
TWILIO_ACCOUNT_SID="{{ netdata_twilio_account_sid }}"
TWILIO_AUTH_TOKEN="{{ netdata_twilio_auth_token }}"
{% if netdata_twilio_from_number | length > 0 %}
TWILIO_FROM_NUMBER="{{ netdata_twilio_from_number }}"
{% endif %}
{% if netdata_twilio_send_resolved | bool %}
TWILIO_SEND_RESOLVED="YES"
{% else %}
TWILIO_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_TWILIO="NO"
{% endif %}

# ============================================================================
# PUSHOVER NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_pushover_enabled | bool and netdata_pushover_user_key | length > 0 and netdata_pushover_api_token | length > 0 %}
SEND_PUSHOVER="YES"
PUSHOVER_USER_KEY="{{ netdata_pushover_user_key }}"
PUSHOVER_API_TOKEN="{{ netdata_pushover_api_token }}"
{% if netdata_pushover_priority is defined %}
PUSHOVER_PRIORITY="{{ netdata_pushover_priority }}"
{% endif %}
{% if netdata_pushover_sound | length > 0 %}
PUSHOVER_SOUND="{{ netdata_pushover_sound }}"
{% endif %}
{% if netdata_pushover_send_resolved | bool %}
PUSHOVER_SEND_RESOLVED="YES"
{% else %}
PUSHOVER_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_PUSHOVER="NO"
{% endif %}

# ============================================================================
# PUSHBULLET NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_pushbullet_enabled | bool and netdata_pushbullet_api_token | length > 0 %}
SEND_PUSHBULLET="YES"
PUSHBULLET_API_TOKEN="{{ netdata_pushbullet_api_token }}"
{% if netdata_pushbullet_send_resolved | bool %}
PUSHBULLET_SEND_RESOLVED="YES"
{% else %}
PUSHBULLET_SEND_RESOLVED="NO"
{% endif %}
{% else %}
SEND_PUSHBULLET="NO"
{% endif %}

# ============================================================================
# CUSTOM WEBHOOK NOTIFICATION SETTINGS
# ============================================================================
{% if netdata_webhook_enabled | bool and netdata_webhook_url | length > 0 %}
SEND_WEBHOOK="YES"
WEBHOOK_URL="{{ netdata_webhook_url }}"
WEBHOOK_METHOD="{{ netdata_webhook_method | default('POST') }}"
WEBHOOK_TIMEOUT="{{ netdata_webhook_timeout | default(10) }}"
{% if netdata_webhook_headers is defined and netdata_webhook_headers | length > 0 %}
{% for key, value in netdata_webhook_headers.items() %}
WEBHOOK_HEADER_{{ key | upper }}="{{ value }}"
{% endfor %}
{% endif %}
{% else %}
SEND_WEBHOOK="NO"
{% endif %}

# ============================================================================
# NOTIFICATION BEHAVIOR
# ============================================================================
# Global settings for notification behavior
ROLES_TO_SKIP=""
ALARMS_TO_SKIP=""

# Log notification failures
LOG_FAILURES="YES"

# Maximum number of notifications per alarm
MAX_NOTIFICATIONS_PER_ALARM="10"
