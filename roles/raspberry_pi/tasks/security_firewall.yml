---
# Firewall Configuration (UFW)

- name: Install UFW
  ansible.builtin.apt:
    name: ufw
    state: present

- name: Set UFW default incoming policy
  community.general.ufw:
    default: "{{ rpi_firewall_default_policy }}"
    direction: incoming

- name: Set UFW default outgoing policy
  community.general.ufw:
    default: allow
    direction: outgoing

- name: Add firewall rules
  community.general.ufw:
    rule: allow
    port: "{{ item.port | default(item) }}"
    proto: "{{ item.proto | default('tcp') }}"
  loop: "{{ rpi_firewall_rules }}"

- name: Enable UFW
  community.general.ufw:
    state: enabled
  when: rpi_firewall_enable | bool
