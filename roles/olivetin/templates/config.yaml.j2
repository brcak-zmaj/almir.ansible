---
# Ansible Managed

# OliveTin Configuration File
# Generated by Ansible role: brcak_zmaj.almir_ansible.olivetin
# For more options, see: https://docs.olivetin.app/configuration/

logLevel: "{{ olivetin_log_level | default('INFO') }}"

{% if olivetin_auth_require_guests_to_login | default(false) | bool %}
authRequireGuestsToLogin: true
{% endif %}

{% if olivetin_access_control_lists is defined and olivetin_access_control_lists | length > 0 %}
accessControlLists:
{% for acl in olivetin_access_control_lists %}
  - name: "{{ acl.name }}"
    permissions:
      view: {{ acl.permissions.view | default(false) | bool | lower }}
      exec: {{ acl.permissions.exec | default(false) | bool | lower }}
      logs: {{ acl.permissions.logs | default(false) | bool | lower }}
{% if acl.match_usergroups is defined and acl.match_usergroups | length > 0 %}
    matchUsergroups:
{% for group in acl.match_usergroups %}
      - "{{ group }}"
{% endfor %}
{% endif %}
{% if acl.match_usernames is defined and acl.match_usernames | length > 0 %}
    matchUsernames:
{% for username in acl.match_usernames %}
      - "{{ username }}"
{% endfor %}
{% endif %}
{% if acl.add_to_every_action | default(false) | bool %}
    addToEveryAction: true
{% endif %}
{% endfor %}
{% endif %}

{% if olivetin_default_permissions is defined %}
defaultPermissions:
  view: {{ olivetin_default_permissions.view | default(true) | bool | lower }}
  exec: {{ olivetin_default_permissions.exec | default(false) | bool | lower }}
  logs: {{ olivetin_default_permissions.logs | default(false) | bool | lower }}
{% endif %}

{% if olivetin_users_with_hashes is defined and olivetin_users_with_hashes | length > 0 %}
authLocalUsers:
  enabled: true
  users:
{% for user in olivetin_users_with_hashes %}
    - username: "{{ user.username }}"
{% if user.usergroup is defined and user.usergroup | length > 0 %}
      usergroup: "{{ user.usergroup }}"
{% endif %}
{% if user.password_hash is defined and user.password_hash | length > 0 %}
      password: "{{ user.password_hash }}"
{% endif %}
{% endfor %}
{% endif %}

actions:
  - title: "Date"
    shell: date
{% if olivetin_auth_require_guests_to_login | default(false) | bool %}
    acl:
      - "admins"
{% endif %}

  - title: "System Information"
    shell: uname -a

  - title: "Disk Usage"
    shell: df -h

{% if olivetin_access_control_lists is defined %}
  - title: "Restart System"
    shell: reboot
    acl:
      - "admins"
    comment: "Requires admin privileges - will not work in containers"

  - title: "View Logs"
    shell: journalctl -n 50
    acl:
      - "admins"
{% endif %}

dashboards:
  - title: "Guest Dashboard"
    contents:
      - title: "Date"
      - title: "System Information"
      - title: "Disk Usage"

{% if olivetin_access_control_lists is defined %}
  - title: "Admin Dashboard"
    contents:
      - title: "Date"
      - title: "System Information"
      - title: "Disk Usage"
      - title: "Restart System"
      - title: "View Logs"
{% endif %}
